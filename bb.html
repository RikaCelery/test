<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.7.1/dist/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
    <title>å°è±¡</title>
  </head>

  <body class="p-3 text-white">
    <div
      class="wrapper pb-4 bg-black size-full flex flex-col gap-4 justify-center items-center"
    >
      <div
        class="text-white relative leading-loose flex justify-center items-center text-4xl bg-transparent text-center"
        value="å°è±¡"
      >
        <span>å°è±¡</span
        ><input
          type="text"
          class="absolute w-screen top-0 h-full opacity-0 bg-black focus:opacity-100 size-full"
          value="å°è±¡"
          onchange="this.parentElement.querySelector('span').textContent = this.value"
        />
      </div>
      <button>
        ç‚¹å‡»å›¾åƒæ ¼å­ç²˜è´´å›¾ç‰‡ï¼ŒåŒå‡»æœ¬åœ°é€‰æ‹©å›¾ç‰‡ï¼Œæ‰€æœ‰çš„å­—ç‚¹å‡»éƒ½å¯ä»¥æ›´æ”¹
      </button>
      <div
        class="rows w-full items flex flex-col gap-4 justify-center items-center"
      >
        <div class="w-full text-white item grid max-w-xl gap-5 px-10 mx-auto">
          <div></div>
          <div class=""></div>
          <input
            class="text-center w-full bg-transparent leading-loose"
            value="åˆå°è±¡"
          />
          <div></div>
          <input
            class="text-center w-full bg-transparent leading-loose"
            value="ç°å°è±¡"
          />
        </div>
      </div>
    </div>
    <button class="w-16 h-10 rounded-md bg-white text-black" onclick="add()">
      ADD
    </button>
    <button class="w-16 h-16 rounded-md bg-cyan-300 text-black" onclick="sc()">
      ğŸ“·
    </button>
    <div class="sc pt-3 flex justify-center items-center"></div>
  </body>
  <script>
    function sc() {
      document.querySelectorAll("button").forEach((b) => {
        b.style.display = "none";
      });
      html2canvas(document.querySelector(".wrapper"), {
        // foreignObjectRendering:true
      }).then(function (canvas) {
        document.querySelector(".sc").innerHTML = "";
        canvas.style.width = "100%";
        canvas.style.height = "auto";
        document.querySelector(".sc").appendChild(canvas);
        // document.body.appendChild(canvas);
        document.querySelectorAll("button").forEach((b) => {
          b.style.display = "";
        });
      });
    }
    function add() {
      $(".items").append(`
      <div class="w-full text-black item grid max-w-xl gap-y-5 px-10 mx-auto">
        <div
          tabindex="0"
          onpaste="handlePaste(event)"
          class="cover bg-cover bg-no-repeat fle x-1 h-full aspect-square p-3 shadow-2xl bg-gray-300 focus:shadow-amber-500 hover:cursor-pointer"
        ></div>
        <div></div>
        <div class="feeling relative aspect-square">
          <div
            class="content whitespace-pre-wrap size-full bg-white text-wrap break-all flex justify-center items-center"
          ></div>
          <textarea
            class="size-full shadow-amber-500 shadow-lg absolute top-0 left-0 opacity-0 focus:opacity-100"
            type="text"
            onblur="console.log(this.parentElement.querySelector('div').textContent = this.value);"
          ></textarea>
        </div>
        <div></div>
        <div class="feeling relative aspect-square">
          <div
            class="content whitespace-pre-wrap size-full bg-white text-wrap break-all flex justify-center items-center"
          ></div>
          <textarea
            class="size-full shadow-amber-500 shadow-lg absolute top-0 left-0 opacity-0 focus:opacity-100"
            type="text"
            onblur="console.log(this.parentElement.querySelector('div').textContent = this.value);"
          ></textarea>
        </div>

    <button class="w-10 h-10 rounded-md bg-white text-red-600" onclick="this.parentElement.remove()">
      X
    </button>
      </div>`);
    }
    function handlePaste(e) {
      /**
       * @type{ClipboardEvent}
       * */
      let event = e;
      var fr = new FileReader();
      fr.onload = function () {
        var dataURL = fr.result;
        // console.log(dataURL);
        event.target.style.backgroundImage = `url(${dataURL})`;
      };
      fr.readAsDataURL(event.clipboardData.files[0]);
      // let d = event.clipboardData.getData("Text")
      // console.log(event.clipboardData.files[0],event.clipboardData.getData("Text"));
    }
    document.querySelectorAll(".cover").forEach((img) => {
      //   img.addEventListener("paste", );
    });
    async function handleClick(event) {
      try {
        // å°è¯•ä»å‰ªè´´æ¿è¯»å–æ•°æ®
        const clipboardItems = await navigator.clipboard.read();
        console.log(clipboardItems);
        for (const clipboardItem of clipboardItems) {
          // æ£€æŸ¥å‰ªè´´æ¿é¡¹æ˜¯å¦æœ‰å›¾åƒç±»å‹
          const imageTypes = ["image/png", "image/jpeg", "image/gif"];
          const blob = await clipboardItem.getType(
            imageTypes.find((t) => clipboardItem.types.includes(t))
          );

          if (blob) {
            // åˆ›å»ºä¸€ä¸ª URL å¯¹è±¡æ¥è¡¨ç¤ºå›¾åƒ
            const imageUrl = URL.createObjectURL(blob);

            // æ›´æ–° img çš„ src å±æ€§
            event.target.src = imageUrl;

            // å¦‚æœåªéœ€è¦ç¬¬ä¸€ä¸ªåŒ¹é…çš„å›¾åƒï¼Œåˆ™å¯ä»¥åœ¨æ­¤å¤„ break
            break;
          }
        }
      } catch (err) {
        console.error("Failed to read clipboard data: ", err);
      }
    }
  </script>
  <style>
    .item {
      grid-template-columns: 1fr 2rem 1fr 1rem 1fr 0;
    }
  </style>
</html>
